"use strict";(self.webpackChunk_ninjaone_webapp=self.webpackChunk_ninjaone_webapp||[]).push([[7090],{26853:(e,a,n)=>{n.d(a,{c:()=>u});var t=n(4519),o=n(58064),r=n(6775),i=n(15077),s=e=>({success:!0,message:""}),l=e=>{var{fields:a,values:n,validate:t,validation:i,validationData:l}=e;if(Array.isArray(a)){var c=0,u={},d={};a.forEach((e=>{var a=(0,r.isNotNilOrEmpty)(e)?e.toString().split("."):[];if(a.length>1){var s=(0,o.ETc)(a,n),v=(0,o.ETc)(a,t),f="function"===typeof v?v(s,n,l):{success:!0,message:""};u=(0,o.uhR)(a,(0,o.ETc)(a,null===i||void 0===i?void 0:i.success),{...null===i||void 0===i?void 0:i.success,...u}),d=(0,o.uhR)(a,(0,o.ETc)(a,null===i||void 0===i?void 0:i.message),{...null===i||void 0===i?void 0:i.message,...d}),u=(0,o.uhR)(a,f.success,u),d=(0,o.uhR)(a,f.message,d),f.success&&c++}else{var m=n[e],g="function"===typeof t[e]?t[e](m,n,l):{success:!0,message:""};u[e]=g.success,d[e]=g.message,g.success&&c++}}));var v=a.length===c;return{success:u,message:d,validated:v}}{var f=!0;function g(e,a,n){var t={};for(var o in a){var r=e[o],i=typeof r,l=a[o];"function"===i?t[o]=r(l,null!==n&&void 0!==n?n:a):"object"===i?t[o]=g(r,l,null!==n&&void 0!==n?n:a):l&&"object"===typeof l&&!Array.isArray(l)&&Object.keys(l).length?t[o]=g(s,l,null!==n&&void 0!==n?n:a):t[o]={success:!0,message:""}}return t}function h(e){var{targetProp:a,defaultValue:n,obj:t}=e,r=(0,o.IDH)(((e,t)=>{var i;return(0,o.e$l)("success",e)||(0,o.e$l)("message",e)?("success"===a&&!1===e[a]&&(f=!1),null!==(i=e[a])&&void 0!==i?i:n):r(e)}));return r(t)}var m=g(t,n);return{success:h({targetProp:"success",defaultValue:!0,obj:m}),message:h({targetProp:"message",defaultValue:"",obj:m}),validated:f}}},c=e=>({values:e.fields||{},validation:{success:{},message:{}},validate:e.validate||{},normalize:e.normalize||{},validateOnChange:e.validateOnChange||!1}),u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,t.useMemo)((()=>c(e)),[e]),[{values:n,validation:r,validate:s},u]=(0,t.useState)(a),d=(0,i.B)(a.values,n),v=(0,t.useCallback)(((e,a)=>u((n=>{var{values:t,validation:r,validate:i,normalize:s,validateOnChange:l}=n,c=e.split(".");if(c.length>1){var u=(0,o.ETc)(c,s),d="function"===typeof u?u(a,t):a,v=(0,o.ETc)(c,r.success),f=(0,o.ETc)(c,i),m="function"===typeof f?f(a,t):{success:!0,message:""},g=l||void 0!==v;return{...n,values:(0,o.uhR)(c,d,t),validation:g?{success:(0,o.uhR)(c,m.success,r.success),message:(0,o.uhR)(c,m.message,r.message)}:r}}var h="function"===typeof s[e]?s[e](a,t):a,p="function"===typeof i[e]?i[e](h,t):{success:!0,message:""},y=l||void 0!==r.success[e];return{...n,values:(0,o.yGi)(e,h,t),validation:y?{success:(0,o.yGi)(e,p.success,r.success),message:(0,o.yGi)(e,p.message,r.message)}:r}}))),[]),f=(0,t.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u((a=>{var{values:n,validation:t,validate:r,normalize:i,validateOnChange:s}=a,l={},c={success:{},message:{}};for(var u in e){var d=u.split("."),v=e[u];if(d.length>1){var f=(0,o.ETc)(d,i),m="function"===typeof f?f(v,n):v,g=(0,o.ETc)(d,t.success),h=(0,o.ETc)(d,r),p=s||void 0!==g;if(l=(0,o.uhR)(d,m,l),p){var y="function"===typeof h?h(v,n):{success:!0,message:""};c.success=(0,o.yGi)(u,y.success,c.success),c.message=(0,o.yGi)(u,y.message,c.message)}}else{var C=s||void 0!==t.success[u],w="function"===typeof i[u]?i[u](v,n):v;if(l[u]=w,C){var b="function"===typeof r[u]?r[u](w,n):{success:!0,message:""};c.success[u]=b.success,c.message[u]=b.message}}}return{...a,values:{...n,...l},validation:{success:{...t.success,...c.success},message:{...t.message,...c.message}}}}))}),[]),m=(0,t.useCallback)(((e,a)=>{u((n=>{var{validate:t,validation:o}=n,r=e||t,{success:i,message:s}=l({...n,fields:r,validationData:a});return{...n,validation:{success:{...o.success,...i},message:{...o.message,...s}}}}))}),[]),g=(0,t.useCallback)(((e,a)=>{var t=e||s,{success:o,message:i,validated:c}=l({fields:t,values:n,validate:s,validation:r,validationData:a});return u((e=>({...e,validation:{success:{...e.validation.success,...o},message:{...e.validation.message,...i}}}))),c}),[n,s,r]),h=(0,t.useCallback)((function(){switch(typeof arguments[0]){case"string":return v(arguments[0],arguments[1]);case"object":if(arguments[0].target instanceof Node){var{type:e,name:a,value:n,files:t,checked:o}=arguments[0].target;switch(e){case"checkbox":return v(a,o);case"file":return v(a,t);default:return v(a,n)}}return f(arguments[0]);default:return}}),[v,f]),p=(0,t.useCallback)((e=>u("function"===typeof e?a=>({...a,validate:e(a.validate)}):a=>({...a,validate:e}))),[]),y=(0,t.useCallback)((e=>u("function"===typeof e?a=>({...a,normalize:e(a.normalize)}):a=>({...a,normalize:e}))),[]);return{values:n,validate:s,validation:r,validateForm:g,validateFormFields:m,resetForm:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(c({...e,...a}))},onChange:h,updateValidate:p,updateNormalize:y,isDirty:d}}},99999:(e,a,n)=>{n.d(a,{D:()=>r});var t=n(4519),o=n(18526);function r(e){var[a,n]=(0,t.useState)(e),r=(0,o.s)();return[a,(0,t.useCallback)((e=>r.current&&n(e)),[r])]}},56536:(e,a,n)=>{n.d(a,{Uj:()=>i});var t=n(6775),o=!1;function r(){return window.store.getState().application.recaptchaPublicKey}function i(e){var{action:a}=e;return window.recaptchaSignature?window.recaptchaSignature.toString():o?window.grecaptcha.enterprise.execute(r(),{action:a}):void(0,t.ninjaReportError)("recaptcha error: grecaptcha script not avialable")}},27531:(e,a,n)=>{n.d(a,{Z:()=>h});var t=n(78544),o=n(50176),r=n(6775),i=n(77537);const s=e=>{var{showWarning:a=!1}=e;return a?(0,i.tZ)(o.g7,{variant:"warning",titleToken:(0,r.localizationKey)("Waiting on Duo verification"),children:(0,r.localized)("Please navigate to the Duo browser tab to verify.")}):null};var l=n(8456),c=n(75493);const u=e=>{var{onRetry:a,showRetryU2fButton:n}=e;return(0,i.BX)(c.kC,{flexDirection:"column",gap:l.default.spacing[2],children:[(0,i.tZ)(o.g7,{children:(0,r.localized)("If applicable, insert security key and activate.")}),n&&(0,i.BX)(i.HY,{children:[(0,i.tZ)(o.g7,{variant:"warning",titleToken:(0,r.localizationKey)("Hardware MFA authentication failed or was cancelled"),children:(0,r.localized)("The authentication process failed because either it was interrupted or there's no matching hardware MFA key registered. You can try registering the key again or using a different MFA method. If you need further assistance, contact your administrator.")}),(0,i.tZ)(o.dM,{onClick:a,children:(0,r.localized)("Retry")})]})]})};var d=n(41554),v=n(4519),f=(0,d.Z)(o.dM,{target:"e1blfegi0"})("margin-top:",l.default.spacing[1],";");const m=e=>{var{resendCode:a,mfaCode:n,onChange:t,validateForm:s,validation:l}=e,u=(0,v.useRef)(null);return(0,v.useEffect)((()=>{setTimeout((()=>{var e;null===(e=u.current)||void 0===e||e.focus()}),0)}),[]),(0,i.BX)(c.xu,{children:[(0,i.tZ)(o.II,{ref:u,labelText:(0,r.localized)("Enter verification code"),placeholder:(0,r.localized)("Enter 6-digit code"),value:n,onChange:t,onBlur:()=>s(["mfaCode"]),name:"mfaCode",errorMessage:l.message.mfaCode,autoComplete:"one-time-code"}),(0,i.tZ)(f,{type:"button",onClick:a,children:(0,r.localized)("Resend Code")})]})};const g=e=>{var{mfaCode:a,onChange:n,validateForm:t,validation:s}=e,l=(0,v.useRef)(null);return(0,v.useEffect)((()=>{setTimeout((()=>{var e;null===(e=l.current)||void 0===e||e.focus()}),0)}),[]),(0,i.tZ)(c.xu,{children:(0,i.tZ)(o.II,{ref:l,labelText:(0,r.localized)("Enter time-based code"),placeholder:(0,r.localized)("Enter 6-digit code"),value:a,onChange:n,onBlur:()=>t(["mfaCode"]),name:"mfaCode",errorMessage:s.message.mfaCode,autoComplete:"one-time-code"})})};const h=e=>{var{onU2fRetry:a,showRetryU2fButton:n,resendSmsCode:o,mfaCode:r,mfaType:l,onChange:c,validateForm:d,validation:v,showDuoWarning:f}=e;return l===t.m5.U2F_TOKEN?(0,i.tZ)(u,{showRetryU2fButton:n,onRetry:a}):l===t.m5.TOTP?(0,i.tZ)(g,{mfaCode:r,onChange:c,validation:v,validateForm:d}):l===t.m5.SMSOTP?(0,i.tZ)(m,{resendCode:o,mfaCode:r,onChange:c,validation:v,validateForm:d}):l===t.m5.DUO?(0,i.tZ)(s,{showWarning:f}):null}},14726:(e,a,n)=>{n.d(a,{ZP:()=>C});var t=n(22637),o=n.n(t),r=n(4519),i=n(55460),s=n(50176),l=n(8456),c=n(58064),u=n(94527),d=n(6775),v=n(78544),f=n(56536),m=n(75493),g=n(27531),h=n(37844),p=n(77537),y=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,v.s2)(e);return e?(0,p.BX)(m.kC,{alignItems:"center",gap:l.default.spacing[2],padding:l.default.spacing[1],children:[n.Icon,(0,p.BX)(m.kC,{flexDirection:"column",children:[(0,p.tZ)(s.uT,{children:(0,d.localized)(n.titleToken)}),a&&(0,p.tZ)(s.uT,{type:"bodyXs",color:"colorTextWeak",children:(0,d.localized)(n.descriptionToken)})]})]}):null};const C=e=>{var{mfaResponse:a,mfaType:n,resetForm:t,setMfaType:C,handleSubmit:w,onClose:b,setLoading:T,validateForm:E,mfaCode:k,onChange:D,validation:U,showLabel:R,showDuoWarning:S=!1,setShowDuoWarning:A,setMfaResponse:F}=e,[I,O]=(0,i.DJ)(!1),[M,z]=(0,i.DJ)(!1),Z=(0,r.useRef)(!1),N=o().parse(window.location.search,{ignoreQueryPrefix:!0}),x=(0,r.useCallback)((async(e,a)=>{try{var n,t=JSON.parse(e),o=await navigator.credentials.get({publicKey:{...t.publicKey,allowCredentials:null===(n=t.publicKey.allowCredentials)||void 0===n?void 0:n.map((e=>({...e,id:Uint8Array.from((0,d.decodeBase64URL)(e.id),(e=>e.charCodeAt(0)))}))),challenge:Uint8Array.from((0,d.decodeBase64URL)(t.publicKey.challenge),(e=>e.charCodeAt(0))),extensions:t.publicKey.extensions}});if(a===v.m5.U2F_TOKEN){z(!0);var r={type:o.type,id:o.id,response:{authenticatorData:u.DS.fromUint8Array(new Uint8Array(o.response.authenticatorData),!0),clientDataJSON:u.DS.fromUint8Array(new Uint8Array(o.response.clientDataJSON),!0),signature:u.DS.fromUint8Array(new Uint8Array(o.response.signature),!0),userHandle:o.response.userHandle&&u.DS.fromUint8Array(new Uint8Array(o.response.userHandle),!0)},clientExtensionResults:o.getClientExtensionResults()};w({publicKeyCredentialEncoded:r,currentMfaType:a})}}catch(i){O(!0),z(!1)}}),[w,z,O]);(0,r.useEffect)((()=>{if(!Z.current&&(Z.current=!0,(null===a||void 0===a?void 0:a.mfaType)===v.m5.U2F_TOKEN)){var{mfaType:e,credsRequest:n}=a;x(n,e)}}),[x,a]);var K=(0,r.useCallback)((async()=>{var e=await(0,f.Uj)({action:"switchMfaLogin"});T(!0);try{await(0,h.O0q)({loginToken:a.loginToken,mfaType:v.m5.SMSOTP,returnTo:N.return_to,recaptchaToken:e})}catch(n){if("INVALID_LOGIN_TOKEN"===(null===n||void 0===n?void 0:n.resultCode))return(0,d.showErrorMessage)((0,d.localized)("Token expired"));(0,d.reportErrorAndShowMessage)(n,(0,d.localizationKey)("An error occurred while sending SMS"))}finally{T(!1)}}),[a.loginToken,N.return_to,T]);(0,r.useEffect)((()=>{null!==a&&void 0!==a&&a.sendSms&&K()}),[null===a||void 0===a?void 0:a.sendSms,K]);var _,L=async e=>{var{value:o,titleToken:r}=e,i=n;null===A||void 0===A||A(!1),t(),C(o),O(!1),T(!0);try{var s,l=null===(s=window.application)||void 0===s?void 0:s.get("user"),u={loginToken:a.loginToken,mfaType:o,returnTo:N.return_to},m=await(l?(0,h.nJz)(u):(0,h.O0q)({...u,recaptchaToken:await(0,f.Uj)({action:"switchMfaLogin"})}));if(o===v.m5.DUO){if(!m.duoUrl)throw new Error("Duo URL not found");var{duoUrl:g,duoChannelId:p}=m;F((e=>({...e,duoUrl:g,duoChannelId:p})))}o===v.m5.U2F_TOKEN&&x(m.credsRequest,o)}catch(y){(0,c.OH4)("resultCode","INVALID_LOGIN_TOKEN",y)?((0,d.showErrorMessage)((0,d.localized)("Token expired")),null===b||void 0===b||b()):(C(i),(0,d.ninjaReportError)("Error switching MFA Types"))}finally{T(!1)}},j=(0,d.debounce)((()=>{t(),L({value:v.m5.SMSOTP})}),500);return(0,p.BX)(m.kC,{flexDirection:"column",gap:l.default.spacing[2],textAlign:"left",children:[(0,p.tZ)(s.Ph,{value:n,triggerAriaLabel:(0,d.localized)("Select MFA method"),options:(_=a.available_mfa,(0,v.$r)(_).map((e=>{var{value:a}=e;return{value:a,LabelComponent:()=>y(a)}}))),labelRenderer:()=>y(n),onChange:e=>L({value:e}),disabled:M,...R&&{labelText:(0,d.localized)("Select MFA method"),labelId:"mfa-type-select"}}),(0,p.tZ)(g.Z,{onU2fRetry:()=>L({value:v.m5.U2F_TOKEN}),showRetryU2fButton:I,resendSmsCode:j,mfaCode:k,onChange:D,validation:U,validateForm:E,mfaType:n,showDuoWarning:S})]})}},57132:(e,a,n)=>{n.d(a,{Z:()=>v});n(4519);var t=n(58064),o=n(55460),r=n(50176),i=n(6775),s=n(34928),l=n(48548),c=n(78544),u=n(14726),d=n(77537);const v=function(e){var{mfaResponse:a,onSubmit:n,onCancel:v,onClose:f,unmount:m}=e,[g,h]=(0,o.DJ)(!1),[p,y]=(0,o.DJ)(a),[C,w]=(0,o.DJ)(!1),{mfaType:b}=p||{},{values:{mfaCode:T},validation:E,onChange:k,validateForm:D,resetForm:U}=(0,l.cI)({fields:{mfaCode:""},validate:{mfaCode:(0,i.withCustomError)((0,s.eWj)("Invalid code"),i.validations.mfaCodeOnlySixDigits)}}),R=async e=>{var{mfaCode:a,currentMfaType:o=b,publicKeyCredentialEncoded:r}=e;if((0,t.q9t)(o,[c.m5.DUO,c.m5.U2F_TOKEN])||D()){h(!0);try{o===c.m5.DUO?await(async()=>{var e;try{if(!p.duoUrl)throw new Error("No Duo URL found");if(!p.duoChannelId)throw new Error("No Duo Channel ID found");w(!0);var a=window.open(p.duoUrl,(0,s.kIE)("Redirecting"));await new Promise(((t,o)=>{e=setInterval((()=>{null!==a&&void 0!==a&&a.closed&&o(new Error("Duo window closed"))}),1e3),window.wamp.subscribeToChannel(p.duoChannelId,(e=>{var[r]=e;if(null===r||void 0===r||!r.mfaCode)return null===a||void 0===a||a.close(),o(new Error("No MFA code returned"));var{mfaCode:i}=r;null===a||void 0===a||a.close(),n({mfaCode:i}),S(),t()}))}))}catch(r){var t,o=null===(t=r.message)||void 0===t?void 0:t.includes("Duo window closed");if(w(!1),o)return void(0,i.showWarningMessage)((0,s.kIE)("Duo tab was closed before authentication was completed"));(0,i.reportErrorAndShowMessage)(r,(0,s.kIE)("Failed to authenticate with Duo security"))}finally{e&&clearInterval(e),p.duoChannelId&&window.wamp.unSubscribeToChannel(p.duoChannelId)}})():(await n({mfaCode:a,publicKeyCredentialEncoded:r}),S())}finally{h(!1)}}};function S(){f(),m()}return(0,d.tZ)("form",{onSubmit:function(e){e.preventDefault(),R({mfaCode:T})},children:(0,d.tZ)(r.u_,{backgroundClassName:"portal-in-custom-fields-form",heading:(0,s.kIE)("Verify MFA"),buttons:b===c.m5.U2F_TOKEN?[]:[{variant:"primary",labelText:(0,s.kIE)("Verify"),submit:!0,disabled:g}],closeAction:function(){f(),v(),m()},unmount:m,cancelable:!0,children:(0,d.tZ)(u.ZP,{handleSubmit:R,mfaCode:T,mfaResponse:p,mfaType:b,onChange:k,onClose:f,resetForm:U,setLoading:h,setMfaResponse:y,setMfaType:e=>y((a=>({...a,mfaType:e}))),setShowDuoWarning:w,showDuoWarning:C,showLabel:!0,validateForm:D,validation:E})})})}}}]);
//# sourceMappingURL=7090.1ec3aca7.js.map